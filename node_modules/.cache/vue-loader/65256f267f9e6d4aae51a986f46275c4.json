{"remainingRequest":"/Users/mk/Desktop/webar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mk/Desktop/webar/src/views/create/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mk/Desktop/webar/src/views/create/index.vue","mtime":1574694768923},{"path":"/Users/mk/Desktop/webar/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mk/Desktop/webar/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/mk/Desktop/webar/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mk/Desktop/webar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCBtb2RlbCBmcm9tICJAL3ZpZXcvbW9kZWwudnVlIjsKaW1wb3J0IGdlbmVyYXRvciBmcm9tICJAL3ZpZXdzL2NyZWF0ZS9nZW5lcmF0b3IudnVlIjsKaW1wb3J0IGZpcmViYXNlIGZyb20gImZpcmViYXNlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGl0bGU6ICIiLAogICAgICBtb2RlbHM6IFtdLAogICAgICBtb2RlbExpc3Q6IFtdLAogICAgICBvcmlnaW5hbDogZmFsc2UsCiAgICAgIGhpcm86IHJlcXVpcmUoIkAvYXNzZXRzL2ltZy9ISVJPLmpwZyIpLAogICAgICB0aXRsZUFsZXJ0OiBmYWxzZSwKICAgICAgaW1nQWxlcnQ6IGZhbHNlLAogICAgICBwYXR0VXJsOiAiIgogICAgfTsKICB9LAogIGNvbXBvbmVudHM6IHsKICAgIC8vIG1vZGVsLAogICAgZ2VuZXJhdG9yCiAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRNb2RlbChtb2RlbExpc3QpIHsKICAgICAgcmV0dXJuIG1vZGVsTGlzdDsKICAgIH0sCiAgICB0aXRsZUNoaygpIHsKICAgICAgaWYgKHRoaXMudGl0bGUgPT0gIiIpIHsKICAgICAgICB0aGlzLnRpdGxlQWxlcnQgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMudGl0bGVBbGVydCA9IGZhbHNlOwogICAgICB9CiAgICB9LAogICAgaW1nQ2hrKG1hcmtlcikgewogICAgICAvLyB0aGlzLm9yaWdpbmFsID09IHRydWUgJiYg55S75YOP44GM44Gq44GECiAgICAgIGlmICh0aGlzLm9yaWdpbmFsID09IHRydWUgJiYgbWFya2VyID09IHRoaXMuJHN0b3JlLnN0YXRlLmRlZmF1bHRNYXJrZXIpIHsKICAgICAgICB0aGlzLmltZ0FsZXJ0ID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmltZ0FsZXJ0ID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBnZXRNb2RlbExpc3RPZlBvc3REYXRhKCkgewogICAgICBjb25zdCByZWZzID0gdGhpcy4kcmVmczsKICAgICAgdGhpcy5tb2RlbExpc3QgPSByZWZzLm1vZGVsLmNyZWF0ZU1vZGVsKCk7CiAgICAgIGNvbnNvbGUubG9nKHRoaXMubW9kZWxMaXN0KTsKICAgIH0sCiAgICBnZXRQYXR0T2ZQb3N0RGF0YSgpIHsKICAgICAgaWYgKHRoaXMudGl0bGVDaGsoKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgcmVmcyA9IHRoaXMuJHJlZnM7CiAgICAgIHRoaXMubW9kZWxMaXN0ID0gcmVmcy5tb2RlbC5jcmVhdGVNb2RlbCgpOwoKICAgICAgaWYgKHRoaXMub3JpZ2luYWwgPT0gdHJ1ZSkgewogICAgICAgIGNvbnNvbGUubG9nKHRoaXMuJHJlZnMuZ2VuZXJhdG9yKTsKICAgICAgICByZWZzLmdlbmVyYXRvci5nZXRQYXR0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wb3N0QXIobnVsbCk7CiAgICAgIH0KICAgIH0sCiAgICBjcmVhdGVRckNvZGUoa2V5KSB7CiAgICAgIHJldHVybiBgaHR0cHM6Ly9jaGFydC5hcGlzLmdvb2dsZS5jb20vY2hhcnQ/Y2hzPTMwMHgzMDAmY2h0PXFyJmNobD1odHRwczovL3dlYi1hci1jaGFuZ2UtYXItcGFnZS5maXJlYmFzZWFwcC5jb20vP3E9JHtrZXl9YDsKICAgIH0sCiAgICBOb2RlVG9IdG1sKG5vZGUpIHsKICAgICAgaWYgKCFub2RlIHx8ICFBcnJheS5pc0FycmF5KG5vZGUpKSByZXR1cm47CgogICAgICB2YXIgdG1wRWxtdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICB2YXIgaSA9IDA7CiAgICAgIHZhciBsZW4gPSAwOwogICAgICB2YXIgbm9kZXMgPSBbXTsKCiAgICAgIC8vIOmrmOmAn+WHpueQhuOBmeOCi+OBjOWvvuW/nOODluODqeOCpuOCtuOCkuiAg+OBiGlubmVySFRNTOOCkuS9v+eUqAogICAgICAvLyB0bXBFbG10LmlubmVySFRNTCA9IGh0bWxTdHI7CiAgICAgIC8vIHRtcEVsbXQuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBodG1sU3RyKTsKCiAgICAgIHJldHVybiB0bXBFbG10LmNoaWxkTm9kZXM7CiAgICB9LAogICAgdXBsb2FkUGF0dChibG9iLCBmaWxlTmFtZSkgewogICAgICAvLyBDcmVhdGUgYSByb290IHJlZmVyZW5jZQogICAgICB2YXIgc3RvcmFnZVJlZiA9IGZpcmViYXNlLnN0b3JhZ2UoKS5yZWYoKTsKCiAgICAgIC8vIENyZWF0ZSBhIHJlZmVyZW5jZSB0byAnaW1hZ2VzL21vdW50YWlucy5qcGcnCiAgICAgIHZhciBtb3VudGFpbkltYWdlc1JlZiA9IHN0b3JhZ2VSZWYuY2hpbGQoYHBhdHQvJHtmaWxlTmFtZX0ucGF0dGApOwoKICAgICAgaWYgKGJsb2IpIHsKICAgICAgICBjb25zb2xlLmxvZygiZmlsZSIpOwogICAgICAgIGNvbnNvbGUubG9nKGJsb2IpOwoKICAgICAgICBtb3VudGFpbkltYWdlc1JlZi5wdXQoYmxvYikudGhlbihmdW5jdGlvbihzbmFwc2hvdCkgewogICAgICAgICAgY29uc29sZS5sb2coIlVwbG9hZGVkIGEgYmxvYiIpOwogICAgICAgICAgY29uc29sZS5sb2coc25hcHNob3QpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgcG9zdEFyKGJsb2IpIHsKICAgICAgLy8gR2V0IGEga2V5IGZvciBhIG5ldyBQb3N0LgogICAgICB2YXIgbmV3UG9zdEtleSA9IGZpcmViYXNlCiAgICAgICAgLmRhdGFiYXNlKCkKICAgICAgICAucmVmKCkKICAgICAgICAuY2hpbGQoInBvc3RzIikKICAgICAgICAucHVzaCgpLmtleTsKCiAgICAgIC8vIEEgcG9zdCBlbnRyeS4KICAgICAgdmFyIHBvc3REYXRhID0ge307CiAgICAgIGlmICh0aGlzLm9yaWdpbmFsKSB7CiAgICAgICAgY29uc3QgcmVmcyA9IHRoaXMuJHJlZnM7CiAgICAgICAgdmFyIG1hcmtlciA9IHJlZnMuZ2VuZXJhdG9yLmdldE1hcmtlcigpOwogICAgICAgIGlmICh0aGlzLmltZ0NoayhtYXJrZXIpKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnNvbGUubG9nKCJibG9iIGJ5ICRlbWl0Iik7CiAgICAgICAgY29uc29sZS5sb2coYmxvYik7CiAgICAgICAgdGhpcy51cGxvYWRQYXR0KGJsb2IsIG5ld1Bvc3RLZXkpOwoKICAgICAgICBwb3N0RGF0YSA9IHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLAogICAgICAgICAgbWFya2VyOiBtYXJrZXIsCiAgICAgICAgICBxcjogdGhpcy5jcmVhdGVRckNvZGUobmV3UG9zdEtleSksCiAgICAgICAgICBtb2RlbDogdGhpcy5tb2RlbExpc3QsCiAgICAgICAgICBvcmlnaW5hbDogdGhpcy5vcmlnaW5hbAogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG9zdERhdGEgPSB7CiAgICAgICAgICB0aXRsZTogdGhpcy50aXRsZSwKICAgICAgICAgIHFyOiB0aGlzLmNyZWF0ZVFyQ29kZShuZXdQb3N0S2V5KSwKICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsTGlzdCwKICAgICAgICAgIG9yaWdpbmFsOiB0aGlzLm9yaWdpbmFsCiAgICAgICAgfTsKICAgICAgfQoKICAgICAgLy8gV3JpdGUgdGhlIG5ldyBwb3N0J3MgZGF0YSBzaW11bHRhbmVvdXNseSBpbiB0aGUgcG9zdHMgbGlzdCBhbmQgdGhlIHVzZXIncyBwb3N0IGxpc3QuCiAgICAgIHZhciB1cGRhdGVzID0ge307CiAgICAgIHVwZGF0ZXNbIi9kYXRhLyIgKyBuZXdQb3N0S2V5XSA9IHBvc3REYXRhOwoKICAgICAgY29uc29sZS5sb2coInBvc3Q6IiwgcG9zdERhdGEpOwoKICAgICAgdGhpcy4kcm91dGVyLnB1c2goIi9saXN0Iik7CiAgICAgIHJldHVybiBmaXJlYmFzZQogICAgICAgIC5kYXRhYmFzZSgpCiAgICAgICAgLnJlZigpCiAgICAgICAgLnVwZGF0ZSh1cGRhdGVzKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/create","sourcesContent":["<template>\n  <div id=\"create\">\n    <h2>作成する</h2>\n    <div id=\"params\">\n      <div class=\"title\">\n        <h3>タイトル</h3>\n        <input placeholder=\"タイトル\" v-model=\"title\" />\n      </div>\n      <div id=\"createdModel\">\n        <h3>モデル</h3>\n        <!-- <model ref=\"model\"></model> -->\n      </div>\n\n      <div class=\"marker\">\n        <h3>マーカー</h3>\n        <div id=\"switch\">\n          <div v-if=\"original\">オリジナルマーカーを使う</div>\n          <div v-else>デフォルトマーカーを使う</div>\n          <select class=\"switch\" v-model=\"original\" active-color=\"#13ce66\" inactive-color=\"#ff4949\">\n            <option :value=\"false\">false</option>\n            <option :value=\"true\">true</option>\n          </select>\n        </div>\n        <div id=\"markerArea\">\n          <generator v-if=\"original\" ref=\"generator\" @blob=\"postAr\"></generator>\n          <img v-else id=\"hiro\" :src=\"hiro\" :alt=\"hiro\" />\n        </div>\n      </div>\n    </div>\n    <div class=\"alert\" v-if=\"titleAlert\" title=\"タイトルを入力してください\" type=\"error\" :closable=\"false\"></div>\n    <div class=\"alert\" v-if=\"imgAlert\" title=\"画像をアップロードしてください\" type=\"error\" :closable=\"false\"></div>\n    <div id=\"create-buttons\">\n      <button type=\"danger\" @click=\"getPattOfPostData\">作成</button>\n    </div>\n  </div>\n</template>\n\n<script>\n// import model from \"@/view/model.vue\";\nimport generator from \"@/views/create/generator.vue\";\nimport firebase from \"firebase\";\n\nexport default {\n  data() {\n    return {\n      title: \"\",\n      models: [],\n      modelList: [],\n      original: false,\n      hiro: require(\"@/assets/img/HIRO.jpg\"),\n      titleAlert: false,\n      imgAlert: false,\n      pattUrl: \"\"\n    };\n  },\n  components: {\n    // model,\n    generator\n  },\n  methods: {\n    getModel(modelList) {\n      return modelList;\n    },\n    titleChk() {\n      if (this.title == \"\") {\n        this.titleAlert = true;\n        return true;\n      } else {\n        this.titleAlert = false;\n      }\n    },\n    imgChk(marker) {\n      // this.original == true && 画像がない\n      if (this.original == true && marker == this.$store.state.defaultMarker) {\n        this.imgAlert = true;\n        return true;\n      } else {\n        this.imgAlert = false;\n      }\n    },\n    getModelListOfPostData() {\n      const refs = this.$refs;\n      this.modelList = refs.model.createModel();\n      console.log(this.modelList);\n    },\n    getPattOfPostData() {\n      if (this.titleChk()) {\n        return;\n      }\n\n      const refs = this.$refs;\n      this.modelList = refs.model.createModel();\n\n      if (this.original == true) {\n        console.log(this.$refs.generator);\n        refs.generator.getPatt();\n      } else {\n        this.postAr(null);\n      }\n    },\n    createQrCode(key) {\n      return `https://chart.apis.google.com/chart?chs=300x300&cht=qr&chl=https://web-ar-change-ar-page.firebaseapp.com/?q=${key}`;\n    },\n    NodeToHtml(node) {\n      if (!node || !Array.isArray(node)) return;\n\n      var tmpElmt = document.createElement(\"div\");\n      var i = 0;\n      var len = 0;\n      var nodes = [];\n\n      // 高速処理するが対応ブラウザを考えinnerHTMLを使用\n      // tmpElmt.innerHTML = htmlStr;\n      // tmpElmt.insertAdjacentHTML('beforeend', htmlStr);\n\n      return tmpElmt.childNodes;\n    },\n    uploadPatt(blob, fileName) {\n      // Create a root reference\n      var storageRef = firebase.storage().ref();\n\n      // Create a reference to 'images/mountains.jpg'\n      var mountainImagesRef = storageRef.child(`patt/${fileName}.patt`);\n\n      if (blob) {\n        console.log(\"file\");\n        console.log(blob);\n\n        mountainImagesRef.put(blob).then(function(snapshot) {\n          console.log(\"Uploaded a blob\");\n          console.log(snapshot);\n        });\n      }\n    },\n    postAr(blob) {\n      // Get a key for a new Post.\n      var newPostKey = firebase\n        .database()\n        .ref()\n        .child(\"posts\")\n        .push().key;\n\n      // A post entry.\n      var postData = {};\n      if (this.original) {\n        const refs = this.$refs;\n        var marker = refs.generator.getMarker();\n        if (this.imgChk(marker)) {\n          return;\n        }\n        console.log(\"blob by $emit\");\n        console.log(blob);\n        this.uploadPatt(blob, newPostKey);\n\n        postData = {\n          title: this.title,\n          marker: marker,\n          qr: this.createQrCode(newPostKey),\n          model: this.modelList,\n          original: this.original\n        };\n      } else {\n        postData = {\n          title: this.title,\n          qr: this.createQrCode(newPostKey),\n          model: this.modelList,\n          original: this.original\n        };\n      }\n\n      // Write the new post's data simultaneously in the posts list and the user's post list.\n      var updates = {};\n      updates[\"/data/\" + newPostKey] = postData;\n\n      console.log(\"post:\", postData);\n\n      this.$router.push(\"/list\");\n      return firebase\n        .database()\n        .ref()\n        .update(updates);\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n#create {\n  #params {\n    width: 100%;\n    div {\n      margin: 0 auto 15px 0;\n\n      h3 {\n        padding: 10px 0 5px 0;\n        margin: 0;\n      }\n\n      input {\n        width: 80%;\n      }\n    }\n\n    .marker {\n      #switch {\n        display: flex;\n        div {\n          font-size: 1rem;\n          vertical-align: 0;\n          margin-right: 15px;\n        }\n\n        .switch {\n          margin-left: 0;\n        }\n      }\n\n      #markerArea {\n        #hiro {\n          max-height: 300px;\n        }\n      }\n    }\n  }\n\n  a-scene {\n    display: block;\n    width: 300px;\n    height: 300px;\n    background: #c3c3c3;\n  }\n\n  #create-buttons {\n    text-align: center;\n    margin: 10px 0 50px 0;\n  }\n\n  .alert {\n    margin: 0 0 10px 0;\n  }\n}\n</style>\n"]}]}