{"remainingRequest":"/Users/mk/Desktop/git/my-web-ar/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mk/Desktop/git/my-web-ar/src/views/create/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/mk/Desktop/git/my-web-ar/src/views/create/index.vue","mtime":1575261825942},{"path":"/Users/mk/Desktop/git/my-web-ar/node_modules/cache-loader/dist/cjs.js","mtime":1575261812576},{"path":"/Users/mk/Desktop/git/my-web-ar/node_modules/babel-loader/lib/index.js","mtime":1575261810540},{"path":"/Users/mk/Desktop/git/my-web-ar/node_modules/cache-loader/dist/cjs.js","mtime":1575261812576},{"path":"/Users/mk/Desktop/git/my-web-ar/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBtb2RlbCBmcm9tICJAL3ZpZXdzL2NyZWF0ZS9tb2RlbC52dWUiOwppbXBvcnQgZ2VuZXJhdG9yIGZyb20gIkAvdmlld3MvY3JlYXRlL2dlbmVyYXRvci52dWUiOwppbXBvcnQgZmlyZWJhc2UgZnJvbSAiZmlyZWJhc2UiOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB0aXRsZTogIiIsCiAgICAgIG1vZGVsczogW10sCiAgICAgIG1vZGVsTGlzdDogW10sCiAgICAgIG9yaWdpbmFsOiBmYWxzZSwKICAgICAgaGlybzogcmVxdWlyZSgiQC9hc3NldHMvaW1nL0hJUk8uanBnIiksCiAgICAgIHRpdGxlQWxlcnQ6IGZhbHNlLAogICAgICBpbWdBbGVydDogZmFsc2UsCiAgICAgIHBhdHRVcmw6ICIiCiAgICB9OwogIH0sCiAgY29tcG9uZW50czogewogICAgbW9kZWwsCiAgICBnZW5lcmF0b3IKICB9LAogIG1ldGhvZHM6IHsKICAgIGdldE1vZGVsKG1vZGVsTGlzdCkgewogICAgICByZXR1cm4gbW9kZWxMaXN0OwogICAgfSwKICAgIHRpdGxlQ2hrKCkgewogICAgICBpZiAodGhpcy50aXRsZSA9PSAiIikgewogICAgICAgIHRoaXMudGl0bGVBbGVydCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy50aXRsZUFsZXJ0ID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBpbWdDaGsobWFya2VyKSB7CiAgICAgIC8vIHRoaXMub3JpZ2luYWwgPT0gdHJ1ZSAmJiDnlLvlg4/jgYzjgarjgYQKICAgICAgaWYgKHRoaXMub3JpZ2luYWwgPT0gdHJ1ZSAmJiBtYXJrZXIgPT0gdGhpcy4kc3RvcmUuc3RhdGUuZGVmYXVsdE1hcmtlcikgewogICAgICAgIHRoaXMuaW1nQWxlcnQgPSB0cnVlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW1nQWxlcnQgPSBmYWxzZTsKICAgICAgfQogICAgfSwKICAgIGdldE1vZGVsTGlzdE9mUG9zdERhdGEoKSB7CiAgICAgIGNvbnN0IHJlZnMgPSB0aGlzLiRyZWZzOwogICAgICB0aGlzLm1vZGVsTGlzdCA9IHJlZnMubW9kZWwuY3JlYXRlTW9kZWwoKTsKICAgICAgY29uc29sZS5sb2codGhpcy5tb2RlbExpc3QpOwogICAgfSwKICAgIGdldFBhdHRPZlBvc3REYXRhKCkgewogICAgICBpZiAodGhpcy50aXRsZUNoaygpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCByZWZzID0gdGhpcy4kcmVmczsKICAgICAgdGhpcy5tb2RlbExpc3QgPSByZWZzLm1vZGVsLmNyZWF0ZU1vZGVsKCk7CgogICAgICBpZiAodGhpcy5vcmlnaW5hbCA9PSB0cnVlKSB7CiAgICAgICAgY29uc29sZS5sb2codGhpcy4kcmVmcy5nZW5lcmF0b3IpOwogICAgICAgIHJlZnMuZ2VuZXJhdG9yLmdldFBhdHQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBvc3RBcihudWxsKTsKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZVFyQ29kZShrZXkpIHsKICAgICAgcmV0dXJuIGBodHRwczovL2NoYXJ0LmFwaXMuZ29vZ2xlLmNvbS9jaGFydD9jaHM9MzAweDMwMCZjaHQ9cXImY2hsPWh0dHBzOi8vd2ViLWFyLWNoYW5nZS1hci1wYWdlLmZpcmViYXNlYXBwLmNvbS8/cT0ke2tleX1gOwogICAgfSwKICAgIE5vZGVUb0h0bWwobm9kZSkgewogICAgICBpZiAoIW5vZGUgfHwgIUFycmF5LmlzQXJyYXkobm9kZSkpIHJldHVybjsKCiAgICAgIHZhciB0bXBFbG10ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHZhciBpID0gMDsKICAgICAgdmFyIGxlbiA9IDA7CiAgICAgIHZhciBub2RlcyA9IFtdOwoKICAgICAgLy8g6auY6YCf5Yem55CG44GZ44KL44GM5a++5b+c44OW44Op44Km44K244KS6ICD44GIaW5uZXJIVE1M44KS5L2/55SoCiAgICAgIC8vIHRtcEVsbXQuaW5uZXJIVE1MID0gaHRtbFN0cjsKICAgICAgLy8gdG1wRWxtdC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZWVuZCcsIGh0bWxTdHIpOwoKICAgICAgcmV0dXJuIHRtcEVsbXQuY2hpbGROb2RlczsKICAgIH0sCiAgICB1cGxvYWRQYXR0KGJsb2IsIGZpbGVOYW1lKSB7CiAgICAgIC8vIENyZWF0ZSBhIHJvb3QgcmVmZXJlbmNlCiAgICAgIHZhciBzdG9yYWdlUmVmID0gZmlyZWJhc2Uuc3RvcmFnZSgpLnJlZigpOwoKICAgICAgLy8gQ3JlYXRlIGEgcmVmZXJlbmNlIHRvICdpbWFnZXMvbW91bnRhaW5zLmpwZycKICAgICAgdmFyIG1vdW50YWluSW1hZ2VzUmVmID0gc3RvcmFnZVJlZi5jaGlsZChgcGF0dC8ke2ZpbGVOYW1lfS5wYXR0YCk7CgogICAgICBpZiAoYmxvYikgewogICAgICAgIGNvbnNvbGUubG9nKCJmaWxlIik7CiAgICAgICAgY29uc29sZS5sb2coYmxvYik7CgogICAgICAgIG1vdW50YWluSW1hZ2VzUmVmLnB1dChibG9iKS50aGVuKGZ1bmN0aW9uKHNuYXBzaG90KSB7CiAgICAgICAgICBjb25zb2xlLmxvZygiVXBsb2FkZWQgYSBibG9iIik7CiAgICAgICAgICBjb25zb2xlLmxvZyhzbmFwc2hvdCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBwb3N0QXIoYmxvYikgewogICAgICAvLyBHZXQgYSBrZXkgZm9yIGEgbmV3IFBvc3QuCiAgICAgIHZhciBuZXdQb3N0S2V5ID0gZmlyZWJhc2UKICAgICAgICAuZGF0YWJhc2UoKQogICAgICAgIC5yZWYoKQogICAgICAgIC5jaGlsZCgicG9zdHMiKQogICAgICAgIC5wdXNoKCkua2V5OwoKICAgICAgLy8gQSBwb3N0IGVudHJ5LgogICAgICB2YXIgcG9zdERhdGEgPSB7fTsKICAgICAgaWYgKHRoaXMub3JpZ2luYWwpIHsKICAgICAgICBjb25zdCByZWZzID0gdGhpcy4kcmVmczsKICAgICAgICB2YXIgbWFya2VyID0gcmVmcy5nZW5lcmF0b3IuZ2V0TWFya2VyKCk7CiAgICAgICAgaWYgKHRoaXMuaW1nQ2hrKG1hcmtlcikpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coImJsb2IgYnkgJGVtaXQiKTsKICAgICAgICBjb25zb2xlLmxvZyhibG9iKTsKICAgICAgICB0aGlzLnVwbG9hZFBhdHQoYmxvYiwgbmV3UG9zdEtleSk7CgogICAgICAgIHBvc3REYXRhID0gewogICAgICAgICAgdGl0bGU6IHRoaXMudGl0bGUsCiAgICAgICAgICBtYXJrZXI6IG1hcmtlciwKICAgICAgICAgIHFyOiB0aGlzLmNyZWF0ZVFyQ29kZShuZXdQb3N0S2V5KSwKICAgICAgICAgIG1vZGVsOiB0aGlzLm1vZGVsTGlzdCwKICAgICAgICAgIG9yaWdpbmFsOiB0aGlzLm9yaWdpbmFsCiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICBwb3N0RGF0YSA9IHsKICAgICAgICAgIHRpdGxlOiB0aGlzLnRpdGxlLAogICAgICAgICAgcXI6IHRoaXMuY3JlYXRlUXJDb2RlKG5ld1Bvc3RLZXkpLAogICAgICAgICAgbW9kZWw6IHRoaXMubW9kZWxMaXN0LAogICAgICAgICAgb3JpZ2luYWw6IHRoaXMub3JpZ2luYWwKICAgICAgICB9OwogICAgICB9CgogICAgICAvLyBXcml0ZSB0aGUgbmV3IHBvc3QncyBkYXRhIHNpbXVsdGFuZW91c2x5IGluIHRoZSBwb3N0cyBsaXN0IGFuZCB0aGUgdXNlcidzIHBvc3QgbGlzdC4KICAgICAgdmFyIHVwZGF0ZXMgPSB7fTsKICAgICAgdXBkYXRlc1siL2RhdGEvIiArIG5ld1Bvc3RLZXldID0gcG9zdERhdGE7CgogICAgICBjb25zb2xlLmxvZygicG9zdDoiLCBwb3N0RGF0YSk7CgogICAgICB0aGlzLiRyb3V0ZXIucHVzaCgiL2xpc3QiKTsKICAgICAgcmV0dXJuIGZpcmViYXNlCiAgICAgICAgLmRhdGFiYXNlKCkKICAgICAgICAucmVmKCkKICAgICAgICAudXBkYXRlKHVwZGF0ZXMpOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/create","sourcesContent":["<template>\n  <div id=\"create\">\n    <h2>作成する</h2>\n    <div id=\"params\">\n      <div class=\"title\">\n        <h3>タイトル</h3>\n        <input placeholder=\"タイトル\" v-model=\"title\" />\n      </div>\n      <div id=\"createdModel\">\n        <h3>モデル</h3>\n        <model ref=\"model\"></model>\n      </div>\n\n      <div class=\"marker\">\n        <h3>マーカー</h3>\n        <div id=\"switch\">\n          <div v-if=\"original\">オリジナルマーカーを使う</div>\n          <div v-else>デフォルトマーカーを使う</div>\n          <select class=\"switch\" v-model=\"original\" active-color=\"#13ce66\" inactive-color=\"#ff4949\">\n            <option :value=\"false\">false</option>\n            <option :value=\"true\">true</option>\n          </select>\n        </div>\n        <div id=\"markerArea\">\n          <generator v-if=\"original\" ref=\"generator\" @blob=\"postAr\"></generator>\n          <img v-else id=\"hiro\" :src=\"hiro\" :alt=\"hiro\" />\n        </div>\n      </div>\n    </div>\n    <div class=\"alert\" v-if=\"titleAlert\" title=\"タイトルを入力してください\" type=\"error\" :closable=\"false\"></div>\n    <div class=\"alert\" v-if=\"imgAlert\" title=\"画像をアップロードしてください\" type=\"error\" :closable=\"false\"></div>\n    <div id=\"create-buttons\">\n      <button type=\"danger\" @click=\"getPattOfPostData\">作成</button>\n    </div>\n  </div>\n</template>\n\n<script>\nimport model from \"@/views/create/model.vue\";\nimport generator from \"@/views/create/generator.vue\";\nimport firebase from \"firebase\";\n\nexport default {\n  data() {\n    return {\n      title: \"\",\n      models: [],\n      modelList: [],\n      original: false,\n      hiro: require(\"@/assets/img/HIRO.jpg\"),\n      titleAlert: false,\n      imgAlert: false,\n      pattUrl: \"\"\n    };\n  },\n  components: {\n    model,\n    generator\n  },\n  methods: {\n    getModel(modelList) {\n      return modelList;\n    },\n    titleChk() {\n      if (this.title == \"\") {\n        this.titleAlert = true;\n        return true;\n      } else {\n        this.titleAlert = false;\n      }\n    },\n    imgChk(marker) {\n      // this.original == true && 画像がない\n      if (this.original == true && marker == this.$store.state.defaultMarker) {\n        this.imgAlert = true;\n        return true;\n      } else {\n        this.imgAlert = false;\n      }\n    },\n    getModelListOfPostData() {\n      const refs = this.$refs;\n      this.modelList = refs.model.createModel();\n      console.log(this.modelList);\n    },\n    getPattOfPostData() {\n      if (this.titleChk()) {\n        return;\n      }\n\n      const refs = this.$refs;\n      this.modelList = refs.model.createModel();\n\n      if (this.original == true) {\n        console.log(this.$refs.generator);\n        refs.generator.getPatt();\n      } else {\n        this.postAr(null);\n      }\n    },\n    createQrCode(key) {\n      return `https://chart.apis.google.com/chart?chs=300x300&cht=qr&chl=https://web-ar-change-ar-page.firebaseapp.com/?q=${key}`;\n    },\n    NodeToHtml(node) {\n      if (!node || !Array.isArray(node)) return;\n\n      var tmpElmt = document.createElement(\"div\");\n      var i = 0;\n      var len = 0;\n      var nodes = [];\n\n      // 高速処理するが対応ブラウザを考えinnerHTMLを使用\n      // tmpElmt.innerHTML = htmlStr;\n      // tmpElmt.insertAdjacentHTML('beforeend', htmlStr);\n\n      return tmpElmt.childNodes;\n    },\n    uploadPatt(blob, fileName) {\n      // Create a root reference\n      var storageRef = firebase.storage().ref();\n\n      // Create a reference to 'images/mountains.jpg'\n      var mountainImagesRef = storageRef.child(`patt/${fileName}.patt`);\n\n      if (blob) {\n        console.log(\"file\");\n        console.log(blob);\n\n        mountainImagesRef.put(blob).then(function(snapshot) {\n          console.log(\"Uploaded a blob\");\n          console.log(snapshot);\n        });\n      }\n    },\n    postAr(blob) {\n      // Get a key for a new Post.\n      var newPostKey = firebase\n        .database()\n        .ref()\n        .child(\"posts\")\n        .push().key;\n\n      // A post entry.\n      var postData = {};\n      if (this.original) {\n        const refs = this.$refs;\n        var marker = refs.generator.getMarker();\n        if (this.imgChk(marker)) {\n          return;\n        }\n        console.log(\"blob by $emit\");\n        console.log(blob);\n        this.uploadPatt(blob, newPostKey);\n\n        postData = {\n          title: this.title,\n          marker: marker,\n          qr: this.createQrCode(newPostKey),\n          model: this.modelList,\n          original: this.original\n        };\n      } else {\n        postData = {\n          title: this.title,\n          qr: this.createQrCode(newPostKey),\n          model: this.modelList,\n          original: this.original\n        };\n      }\n\n      // Write the new post's data simultaneously in the posts list and the user's post list.\n      var updates = {};\n      updates[\"/data/\" + newPostKey] = postData;\n\n      console.log(\"post:\", postData);\n\n      this.$router.push(\"/list\");\n      return firebase\n        .database()\n        .ref()\n        .update(updates);\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\">\n#create {\n  #params {\n    width: 100%;\n    & > div {\n      margin: 0 auto 15px 0;\n\n      & > h3 {\n        padding: 10px 0 5px 0;\n        margin: 0;\n      }\n\n      & > input {\n        width: 80%;\n      }\n    }\n\n    .marker {\n      #switch {\n        display: flex;\n        div {\n          font-size: 1rem;\n          vertical-align: 0;\n          margin-right: 15px;\n        }\n\n        .switch {\n          margin-left: 0;\n        }\n      }\n\n      #markerArea {\n        #hiro {\n          max-height: 300px;\n        }\n      }\n    }\n  }\n\n  a-scene {\n    display: block;\n    width: 300px;\n    height: 300px;\n    background: #c3c3c3;\n  }\n\n  #create-buttons {\n    text-align: center;\n    margin: 10px 0 50px 0;\n  }\n\n  .alert {\n    margin: 0 0 10px 0;\n  }\n}\n</style>\n"]}]}